---

- name: filebeat | fetching ssl certificate from elk host
  synchronize:
    src: '{{ elk_ssl_cert_remote_path }}'
    dest: '{{ elk_ssl_cert_local_path }}'
  delegate_to: '{{ elk_server }}'

- name: filebeat | import elastic GPG-KEY
  rpm_key:
    key: 'https://artifacts.elastic.co/GPG-KEY-elasticsearch'
    state: present

- name: filebeat | adding elastic repository
  copy:
    src: 'elastic.repo'
    dest: '/etc/yum.repos.d/elasticsearch.repo'
    owner: root
    group: root
    mode: 0644

- name: filebeat | installing filebeat
  yum:
    name: filebeat
    state: installed

- name: filebeat | starting and enabling filebeat service
  service:
    name: filebeat
    state: started
    enabled: yes

- name: filebeat | copying configuration file
  template:
    src: 'filebeat.yml.j2'
    dest: '/etc/filebeat/filebeat.yml'
    mode: 0644
  notify: restart filebeat
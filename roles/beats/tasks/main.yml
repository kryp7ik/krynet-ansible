---
# Can't get this module to work properly so the ansible host fetched the certificate and will copy it to this server
#- name: filebeat | fetching ssl certificate from elk host
#  synchronize:
#    src: '{{ elk_ssl_cert_remote_path }}'
#    dest: 'rsync://{{ elk_ssl_cert_local_path }}'
#  delegate_to: '{{ elk_server }}'

- name: beats | checking if certificate exists
  stat:
    path: '{{ elk_ssl_cert_local_path }}'
  register: cert_exists

- name: beats | copying ssl certificate
  copy:
    src: '/tmp/logstash-forwarder.crt'
    dest: '{{ elk_ssl_cert_local_path }}'
    owner: root
    group: root
    mode: 0644
  when: cert_exists.stat.exists

- name: beats | import elastic GPG-KEY
  rpm_key:
    key: 'https://artifacts.elastic.co/GPG-KEY-elasticsearch'
    state: present

- name: beats | adding elastic repository
  copy:
    src: 'elastic.repo'
    dest: '/etc/yum.repos.d/elasticsearch.repo'
    owner: root
    group: root
    mode: 0644

- include: filebeat.yml
  when: install_filebeat

- include: metricbeat.yml
  when: install_metricbeat